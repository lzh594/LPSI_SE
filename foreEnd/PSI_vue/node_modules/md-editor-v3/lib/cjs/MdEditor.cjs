"use strict";var Oe=Object.defineProperty;var qe=(t,l,r)=>l in t?Oe(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r;var R=(t,l,r)=>(qe(t,typeof l!="symbol"?l+"":l,r),r);const e=require("vue"),a=require("./chunks/config.cjs"),K=require("./chunks/index2.cjs"),h=require("./chunks/index4.cjs"),X=require("@vavt/util"),S=require("./chunks/index.cjs"),Re=require("./chunks/dom.cjs"),ce=require("./chunks/index3.cjs"),Y=require("codemirror"),Q=require("@codemirror/view"),Pe=require("@codemirror/language-data"),je=require("@codemirror/lang-markdown"),ae=require("@codemirror/commands"),ee=require("@codemirror/language"),c=require("@lezer/highlight"),A=require("@codemirror/state"),Ge=require("@codemirror/autocomplete"),Fe=require("./MdCatalog.cjs"),Ne=require("./chunks/vue-tsx.cjs"),Ue=require("./NormalToolbar.cjs");require("medium-zoom");require("copy-to-clipboard");require("markdown-it");require("markdown-it-image-figures");require("markdown-it-task-lists");require("lru-cache");const Ke=e.defineComponent({setup(){return()=>e.createVNode("div",{class:`${a.prefix}-divider`},null)}}),_e={noPrettier:{type:Boolean},toolbars:{type:Array,default:()=>[]},toolbarsExclude:{type:Array,default:()=>[]},setting:{type:Object,default:()=>({})},screenfull:{type:Object,default:null},screenfullJs:{type:String,default:""},updateSetting:{type:Function,default:()=>{}},tableShape:{type:Array,default:()=>[6,4]},defToolbars:{type:Object},noUploadImg:{type:Boolean}},We=t=>{var g,u,d,b;const l=e.inject("editorId");let r=(u=(g=a.configOption.editorExtensions)==null?void 0:g.screenfull)==null?void 0:u.instance;const o=(b=(d=a.configOption.editorExtensions)==null?void 0:d.screenfull)==null?void 0:b.js,i=e.ref(!1),n=x=>{if(!r){h.bus.emit(l,"errorCatcher",{name:"fullscreen",message:"fullscreen is undefined"});return}r.isEnabled?(i.value=!0,(x===void 0?!r.isFullscreen:x)?r.request():r.exit()):console.error("browser does not support screenfull!")},s=()=>{r&&r.isEnabled&&r.on("change",()=>{(i.value||t.setting.fullscreen)&&(i.value=!1,t.updateSetting("fullscreen"))})},f=()=>{r=window.screenfull,s()};return e.onMounted(()=>{if(s(),!r){const x=document.createElement("script");x.src=o||a.screenfullUrl,x.onload=f,x.id=`${a.prefix}-screenfull`,Re.appendHandler(x,"screenfull")}}),e.onMounted(()=>{h.bus.on(l,{name:S.CHANGE_FULL_SCREEN,callback:n})}),{fullscreenHandler:n}},ze={tableShape:{type:Array,default:()=>[6,4]},onSelected:{type:Function,default:()=>{}}},Ye=e.defineComponent({name:"TableShape",props:ze,setup(t){const l=e.reactive({x:-1,y:-1});return()=>e.createVNode("div",{class:`${a.prefix}-table-shape`,onMouseleave:()=>{l.x=-1,l.y=-1}},[new Array(t.tableShape[1]).fill("").map((r,o)=>e.createVNode("div",{class:`${a.prefix}-table-shape-row`,key:`table-shape-row-${o}`},[new Array(t.tableShape[0]).fill("").map((i,n)=>e.createVNode("div",{class:`${a.prefix}-table-shape-col`,key:`table-shape-col-${n}`,onMouseenter:()=>{l.x=o,l.y=n},onClick:()=>{t.onSelected(l)}},[e.createVNode("div",{class:[`${a.prefix}-table-shape-col-default`,o<=l.x&&n<=l.y&&`${a.prefix}-table-shape-col-include`]},null)]))]))])}}),Ze=Ye,Je={type:{type:String,default:"link"},visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},Xe=e.defineComponent({props:Je,setup(t){const l=e.inject("usedLanguageText"),r=e.inject("editorId"),o=e.computed(()=>{var n,s;switch(t.type){case"link":return(n=l.value.linkModalTips)==null?void 0:n.linkTitle;case"image":return(s=l.value.linkModalTips)==null?void 0:s.imageTitle;default:return""}}),i=e.reactive({desc:"",url:""});return e.watch(()=>t.visible,n=>{n||setTimeout(()=>{i.desc="",i.url=""},200)}),()=>e.createVNode(ce.Modal,{title:o.value,visible:t.visible,onClose:t.onCancel},{default:()=>{var n,s,f,g,u;return[e.createVNode("div",{class:`${a.prefix}-form-item`},[e.createVNode("label",{class:`${a.prefix}-label`,for:`link-desc-${r}`},[(n=l.value.linkModalTips)==null?void 0:n.descLabel]),e.createVNode("input",{placeholder:(s=l.value.linkModalTips)==null?void 0:s.descLabelPlaceHolder,class:`${a.prefix}-input`,id:`link-desc-${r}`,type:"text",value:i.desc,onChange:d=>{i.desc=d.target.value},autocomplete:"off"},null)]),e.createVNode("div",{class:`${a.prefix}-form-item`},[e.createVNode("label",{class:`${a.prefix}-label`,for:`link-url-${r}`},[(f=l.value.linkModalTips)==null?void 0:f.urlLabel]),e.createVNode("input",{placeholder:(g=l.value.linkModalTips)==null?void 0:g.urlLabelPlaceHolder,class:`${a.prefix}-input`,id:`link-url-${r}`,type:"text",value:i.url,onChange:d=>{i.url=d.target.value},autocomplete:"off"},null)]),e.createVNode("div",{class:`${a.prefix}-form-item`},[e.createVNode("button",{class:[`${a.prefix}-btn`,`${a.prefix}-btn-row`],type:"button",onClick:()=>{t.onOk(i),i.desc="",i.url=""}},[(u=l.value.linkModalTips)==null?void 0:u.buttonOK])])]}})}}),Qe={visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},et=e.defineComponent({props:Qe,setup(t){var d,b,x;const l=e.inject("usedLanguageText"),r=e.inject("editorId");let o=(x=(b=(d=a.configOption)==null?void 0:d.editorExtensions)==null?void 0:b.cropper)==null?void 0:x.instance;const i=e.ref(),n=e.ref(),s=e.ref(),f=e.reactive({cropperInited:!1,imgSelected:!1,imgSrc:"",isFullscreen:!1});let g=null;e.watch(()=>t.visible,()=>{t.visible&&!f.cropperInited&&(o=o||window.Cropper,i.value.onchange=()=>{if(!o){h.bus.emit(r,"errorCatcher",{name:"Cropper",message:"Cropper is undefined"});return}const p=i.value.files||[];if(f.imgSelected=!0,(p==null?void 0:p.length)>0){const v=new FileReader;v.onload=m=>{f.imgSrc=m.target.result,e.nextTick(()=>{g=new o(n.value,{viewMode:2,preview:`.${a.prefix}-clip-preview-target`})})},v.readAsDataURL(p[0])}})}),e.watch(()=>[f.imgSelected],()=>{s.value.style=""}),e.watch(()=>f.isFullscreen,()=>{e.nextTick(()=>{g==null||g.destroy(),s.value.style="",n.value&&(g=new o(n.value,{viewMode:2,preview:`.${a.prefix}-clip-preview-target`}))})});const u=()=>{g.clear(),g.destroy(),g=null,i.value.value="",f.imgSelected=!1};return()=>{var p;return e.createVNode(ce.Modal,{class:`${a.prefix}-modal-clip`,title:(p=l.value.clipModalTips)==null?void 0:p.title,visible:t.visible,onClose:t.onCancel,showAdjust:!0,isFullscreen:f.isFullscreen,onAdjust:v=>{f.isFullscreen=v},width:"668px",height:"421px"},{default:()=>{var v,m;return[e.createVNode("div",{class:`${a.prefix}-form-item ${a.prefix}-clip`},[e.createVNode("div",{class:`${a.prefix}-clip-main`},[f.imgSelected?e.createVNode("div",{class:`${a.prefix}-clip-cropper`},[e.createVNode("img",{src:f.imgSrc,ref:n,style:{display:"none"},alt:""},null),e.createVNode("div",{class:`${a.prefix}-clip-delete`,onClick:u},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-delete"},null)])])]):e.createVNode("div",{class:`${a.prefix}-clip-upload`,onClick:()=>{i.value.click()}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-upload"},null)])])]),e.createVNode("div",{class:`${a.prefix}-clip-preview`},[e.createVNode("div",{class:`${a.prefix}-clip-preview-target`,ref:s},null)])]),e.createVNode("div",{class:`${a.prefix}-form-item`},[e.createVNode("button",{class:`${a.prefix}-btn`,type:"button",onClick:()=>{if(g){const k=g.getCroppedCanvas();h.bus.emit(r,"uploadImage",[h.base642File(k.toDataURL("image/png"))],t.onOk),u()}}},[((v=l.value.clipModalTips)==null?void 0:v.buttonUpload)||((m=l.value.linkModalTips)==null?void 0:m.buttonOK)])]),e.createVNode("input",{ref:i,accept:"image/*",type:"file",multiple:!1,style:{display:"none"}},null)]}})}}}),tt={type:{type:String,default:"link"},linkVisible:{type:Boolean,default:!1},clipVisible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},ot=e.defineComponent({props:tt,setup(t){return()=>e.createVNode(e.Fragment,null,[e.createVNode(Xe,{type:t.type,visible:t.linkVisible,onOk:t.onOk,onCancel:t.onCancel},null),e.createVNode(et,{visible:t.clipVisible,onOk:t.onOk,onCancel:t.onCancel},null)])}}),lt=e.defineComponent({name:"MDEditorToolbar",props:_e,setup(t){const l=e.inject("editorId"),r=e.inject("usedLanguageText"),{fullscreenHandler:o}=We(t),i=`${l}-toolbar-wrapper`,n=e.reactive({title:!1,catalog:!1,image:!1,table:!1,mermaid:!1,katex:!1}),s=(p,v)=>{h.bus.emit(l,"replace",p,v)},f=e.reactive({type:"link",linkVisible:!1,clipVisible:!1}),g=e.ref();e.onMounted(()=>{h.bus.on(l,{name:"openModals",callback(p){f.type=p,f.linkVisible=!0}})});const u=e.computed(()=>{const p=t.toolbars.filter(V=>!t.toolbarsExclude.includes(V)),v=p.indexOf("="),m=v===-1?p:p.slice(0,v+1),k=v===-1?[]:p.slice(v,Number.MAX_SAFE_INTEGER);return[m,k]}),d=e.ref(),b=()=>{h.bus.emit(l,"uploadImage",Array.from(d.value.files||[])),d.value.value=""};e.onMounted(()=>{d.value.addEventListener("change",b)});const x=p=>{var v,m,k,V,N,y,T,C,w,F,M,E,B,H,D,P,O,te,_,j,q,W,G,L,I,z,oe,se,de,ue,fe,ge,me,he,pe,be,ve,ke,xe,Ce,$e,Ve,ye;if(a.allToolbar.includes(p))switch(p){case"-":return e.createVNode(Ke,null,null);case"bold":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(v=r.value.toolbarTips)==null?void 0:v.bold,onClick:()=>{s("bold")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-bold"},null)])]);case"underline":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(m=r.value.toolbarTips)==null?void 0:m.underline,onClick:()=>{s("underline")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-underline"},null)])]);case"italic":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(k=r.value.toolbarTips)==null?void 0:k.italic,onClick:()=>{s("italic")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-italic"},null)])]);case"strikeThrough":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(V=r.value.toolbarTips)==null?void 0:V.strikeThrough,onClick:()=>{s("strikeThrough")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-strike-through"},null)])]);case"title":return e.createVNode(K.Dropdown,{relative:`#${i}`,visible:n.title,onChange:$=>{n.title=$},overlay:e.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{n.title=!1}},[e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("h1")}},[(N=r.value.titleItem)==null?void 0:N.h1]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("h2")}},[(y=r.value.titleItem)==null?void 0:y.h2]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("h3")}},[(T=r.value.titleItem)==null?void 0:T.h3]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("h4")}},[(C=r.value.titleItem)==null?void 0:C.h4]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("h5")}},[(w=r.value.titleItem)==null?void 0:w.h5]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("h6")}},[(F=r.value.titleItem)==null?void 0:F.h6])])},{default:()=>{var $;return[e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:($=r.value.toolbarTips)==null?void 0:$.title},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-title"},null)])])]}});case"sub":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(M=r.value.toolbarTips)==null?void 0:M.sub,onClick:()=>{s("sub")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-sub"},null)])]);case"sup":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(E=r.value.toolbarTips)==null?void 0:E.sup,onClick:()=>{s("sup")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-sup"},null)])]);case"quote":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(B=r.value.toolbarTips)==null?void 0:B.quote,onClick:()=>{s("quote")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-quote"},null)])]);case"unorderedList":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(H=r.value.toolbarTips)==null?void 0:H.unorderedList,onClick:()=>{s("unorderedList")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-unordered-list"},null)])]);case"orderedList":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(D=r.value.toolbarTips)==null?void 0:D.orderedList,onClick:()=>{s("orderedList")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-ordered-list"},null)])]);case"task":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(P=r.value.toolbarTips)==null?void 0:P.task,onClick:()=>{s("task")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-task"},null)])]);case"codeRow":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(O=r.value.toolbarTips)==null?void 0:O.codeRow,onClick:()=>{s("codeRow")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-code-row"},null)])]);case"code":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(te=r.value.toolbarTips)==null?void 0:te.code,onClick:()=>{s("code")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-code"},null)])]);case"link":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(_=r.value.toolbarTips)==null?void 0:_.link,onClick:()=>{f.type="link",f.linkVisible=!0}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-link"},null)])]);case"image":return t.noUploadImg?e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(j=r.value.toolbarTips)==null?void 0:j.image,onClick:()=>{f.type="image",f.linkVisible=!0}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-image"},null)])]):e.createVNode(K.Dropdown,{relative:`#${i}`,visible:n.image,onChange:$=>{n.image=$},overlay:e.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{n.title=!1}},[e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{f.type="image",f.linkVisible=!0}},[(q=r.value.imgTitleItem)==null?void 0:q.link]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{d.value.click()}},[(W=r.value.imgTitleItem)==null?void 0:W.upload]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{f.clipVisible=!0}},[(G=r.value.imgTitleItem)==null?void 0:G.clip2upload])])},{default:()=>{var $;return[e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:($=r.value.toolbarTips)==null?void 0:$.image},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-image"},null)])])]}});case"table":return e.createVNode(K.Dropdown,{relative:`#${i}`,visible:n.table,onChange:$=>{n.table=$},key:"bar-table",overlay:e.createVNode(Ze,{tableShape:t.tableShape,onSelected:$=>{s("table",{selectedShape:$})}},null)},{default:()=>{var $;return[e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:($=r.value.toolbarTips)==null?void 0:$.table},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-table"},null)])])]}});case"revoke":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(L=r.value.toolbarTips)==null?void 0:L.revoke,onClick:()=>{h.bus.emit(l,"ctrlZ")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-revoke"},null)])]);case"next":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(I=r.value.toolbarTips)==null?void 0:I.next,onClick:()=>{h.bus.emit(l,"ctrlShiftZ")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-next"},null)])]);case"save":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(z=r.value.toolbarTips)==null?void 0:z.save,onClick:()=>{h.bus.emit(l,S.ON_SAVE)}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-baocun"},null)])]);case"prettier":return t.noPrettier?"":e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(oe=r.value.toolbarTips)==null?void 0:oe.prettier,onClick:()=>{s("prettier")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-prettier"},null)])]);case"pageFullscreen":return!t.setting.fullscreen&&e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(se=r.value.toolbarTips)==null?void 0:se.pageFullscreen,onClick:()=>{t.updateSetting("pageFullscreen")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":`#md-editor-icon-${t.setting.pageFullscreen?"suoxiao":"fangda"}`},null)])]);case"fullscreen":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(de=r.value.toolbarTips)==null?void 0:de.fullscreen,onClick:()=>{o()}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":`#md-editor-icon-${t.setting.fullscreen?"fullscreen-exit":"fullscreen"}`},null)])]);case"preview":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(ue=r.value.toolbarTips)==null?void 0:ue.preview,onClick:()=>{t.updateSetting("preview")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-preview"},null)])]);case"htmlPreview":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(fe=r.value.toolbarTips)==null?void 0:fe.htmlPreview,onClick:()=>{t.updateSetting("htmlPreview")}},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-coding"},null)])]);case"catalog":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(ge=r.value.toolbarTips)==null?void 0:ge.catalog,onClick:()=>{h.bus.emit(l,S.CHANGE_CATALOG_VISIBLE)},key:"bar-catalog"},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-catalog"},null)])]);case"github":return e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:(me=r.value.toolbarTips)==null?void 0:me.github,onClick:()=>X.linkTo("https://github.com/imzbf/md-editor-v3")},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-github"},null)])]);case"mermaid":return e.createVNode(K.Dropdown,{relative:`#${i}`,visible:n.mermaid,onChange:$=>{n.mermaid=$},overlay:e.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{n.mermaid=!1}},[e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("flow")}},[(he=r.value.mermaid)==null?void 0:he.flow]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("sequence")}},[(pe=r.value.mermaid)==null?void 0:pe.sequence]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("gantt")}},[(be=r.value.mermaid)==null?void 0:be.gantt]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("class")}},[(ve=r.value.mermaid)==null?void 0:ve.class]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("state")}},[(ke=r.value.mermaid)==null?void 0:ke.state]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("pie")}},[(xe=r.value.mermaid)==null?void 0:xe.pie]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("relationship")}},[(Ce=r.value.mermaid)==null?void 0:Ce.relationship]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("journey")}},[($e=r.value.mermaid)==null?void 0:$e.journey])]),key:"bar-mermaid"},{default:()=>{var $;return[e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:($=r.value.toolbarTips)==null?void 0:$.mermaid},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-mermaid"},null)])])]}});case"katex":return e.createVNode(K.Dropdown,{relative:`#${i}`,visible:n.katex,onChange:$=>{n.katex=$},overlay:e.createVNode("ul",{class:`${a.prefix}-menu`,onClick:()=>{n.katex=!1}},[e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("katexInline")}},[(Ve=r.value.katex)==null?void 0:Ve.inline]),e.createVNode("li",{class:`${a.prefix}-menu-item`,onClick:()=>{s("katexBlock")}},[(ye=r.value.katex)==null?void 0:ye.block])]),key:"bar-katex"},{default:()=>{var $;return[e.createVNode("div",{class:`${a.prefix}-toolbar-item`,title:($=r.value.toolbarTips)==null?void 0:$.katex},[e.createVNode("svg",{class:`${a.prefix}-icon`,"aria-hidden":"true"},[e.createVNode("use",{"xlink:href":"#md-editor-icon-formula"},null)])])]}})}else return t.defToolbars instanceof Array?t.defToolbars[p]||"":t.defToolbars&&t.defToolbars.children instanceof Array&&t.defToolbars.children[p]||""};return()=>{const p=u.value[0].map(m=>x(m)),v=u.value[1].map(m=>x(m));return e.createVNode(e.Fragment,null,[t.toolbars.length>0&&e.createVNode("div",{class:`${a.prefix}-toolbar-wrapper`,id:i},[e.createVNode("div",{class:`${a.prefix}-toolbar`},[e.createVNode("div",{class:`${a.prefix}-toolbar-left`,ref:g},[p]),e.createVNode("div",{class:`${a.prefix}-toolbar-right`},[v])])]),e.createVNode("input",{ref:d,accept:"image/*",type:"file",multiple:!0,style:{display:"none"}},null),e.createVNode(ot,{linkVisible:f.linkVisible,clipVisible:f.clipVisible,type:f.type,onCancel:()=>{f.linkVisible=!1,f.clipVisible=!1},onOk:m=>{m&&s(f.type,{desc:m.desc,url:m.url}),f.linkVisible=!1,f.clipVisible=!1}},null)])}}}),at=(t,l)=>{const r=X.debounce(()=>{t.removeEventListener("scroll",o),t.addEventListener("scroll",o),l.removeEventListener("scroll",o),l.addEventListener("scroll",o)},50),o=i=>{const n=t.clientHeight,s=l.clientHeight,f=t.scrollHeight,g=l.scrollHeight,u=(f-n)/(g-s);i.target===t?(l.removeEventListener("scroll",o),l.scrollTo({top:t.scrollTop/u}),r()):(t.removeEventListener("scroll",o),t.scrollTo({top:l.scrollTop*u}),r())};return[()=>{r().finally(()=>{t.dispatchEvent(new Event("scroll"))})},()=>{t.removeEventListener("scroll",o),l.removeEventListener("scroll",o)}]},rt=(t,l,r)=>{const{view:o}=r,i=b=>o.lineBlockAt(o.state.doc.line(b).from).top,n=b=>o.lineBlockAt(o.state.doc.line(b).from).height;let s=[];const f=()=>{s=[];const b=Array.from(l.querySelectorAll("[data-line]")).map(m=>Number(m.dataset.line)+1),{lines:x}=o.state.doc;let p=1,v=b.shift()??x;for(let m=1;m<=x;m++)m===v&&(p=m,v=b.shift()||x+1),s.push({start:p,end:v-1})};let g=0,u=0;const d=X.throttle(b=>{var v,m,k,V,N,y,T;if(!((v=l.firstElementChild)!=null&&v.firstElementChild))return;const x=o.lineBlockAtHeight(o.scrollDOM.scrollTop),{number:p}=o.state.doc.lineAt(x.from);if(!(p>s.length)&&!(o.state.doc.lines<s[s.length-1].end))if(b.target===t){if(u!==0)return;g++;const C=s[p-1],w=i(C.end)+n(C.end);let F=0;const M=i(C.start),E=l.querySelector(`[data-line="${C.start-1}"]`)||((m=l.firstElementChild)==null?void 0:m.firstElementChild),B=l.querySelector(`[data-line="${C.end}"]`)||((k=l.lastElementChild)==null?void 0:k.lastElementChild);let H=0,D=0;M===0?(F=(o.scrollDOM.scrollTop-M)/(w-M),H=B.offsetTop):w>o.scrollDOM.scrollHeight-o.scrollDOM.clientHeight?(F=(o.scrollDOM.scrollTop-M)/(o.scrollDOM.scrollHeight-o.scrollDOM.clientHeight-M),D=E.offsetTop,H=l.scrollHeight-l.clientHeight-D+10):(F=(o.scrollDOM.scrollTop-M)/(w-M),D=E.offsetTop,H=B.offsetTop-D);const P=D-10+H*F;X.smoothScroll(l,P,()=>{g--})}else{if(g!==0)return;u++;const C=Array.from(l.querySelectorAll("[data-line]")),w=l.scrollTop,F=l.scrollHeight;let M=C.length===0?1:Math.ceil(Number(C[C.length-1].dataset.line)*(w/F)),E=(V=l.firstElementChild)==null?void 0:V.firstElementChild;for(let L=M;L>=0;L--){const I=l.querySelector(`[data-line="${L}"]`);if(I&&I.offsetTop<=w){E=I,M=L;break}}let B=(N=l.firstElementChild)==null?void 0:N.firstElementChild,H=(y=l.firstElementChild)==null?void 0:y.lastElementChild;for(;C.length>0;){const L=C.indexOf(E);if(L+1>=C.length)break;const I=C[L+1];if(L===-1){H=I;break}const z=E.offsetTop;if(z>w){if(L===0){B=E,H=I;break}E=C[L-1];continue}const oe=I.offsetTop;if(z<=w&&oe>w){B=E,H=I;break}E=I}const D=B.offsetTop,P=H.offsetTop;let O=0;const{start:te,end:_}=s[Number(B.dataset.line||0)],j=i(te);let q=i(_);const W=n(_);let G=0;B===((T=l.firstElementChild)==null?void 0:T.firstElementChild)?(O=Math.max(w/P,0),G=q+W-j):q>o.scrollDOM.scrollHeight-o.scrollDOM.clientHeight?(O=Math.max((w-D)/(l.scrollHeight-D-l.clientHeight),0),q=i(o.state.doc.lines)+n(o.state.doc.lines),G=8+q-j-t.clientHeight):(O=Math.max((w-D)/(P-D),0),G=q+W-j),X.smoothScroll(t,j+G*O,()=>{u--})}},10);return[()=>{f(),t.addEventListener("scroll",d),l.addEventListener("scroll",d),t.dispatchEvent(new Event("scroll"))},()=>{s=[],t.removeEventListener("scroll",d),l.removeEventListener("scroll",d)}]},nt=(t,l,r)=>{const o=e.inject("editorId");let i=()=>{},n=()=>{};const s=()=>{i();const f=document.querySelector(".cm-scroller"),g=document.querySelector(`[id="${o}-preview-wrapper"][data-show="true"]`),u=document.querySelector(`[id="${o}-html-wrapper"][data-show="true"]`);(g||u)&&([n,i]=(g?rt:at)(f,g||u,r.value)),t.scrollAuto&&n()};e.watch([l,e.toRef(t.setting,"preview"),e.toRef(t.setting,"htmlPreview"),e.toRef(t.setting,"fullscreen"),e.toRef(t.setting,"pageFullscreen")],()=>{e.nextTick(s)}),e.watch(()=>t.scrollAuto,f=>{f?n():i()}),e.onMounted(s)},it=nt,ct=(t,l,r)=>{var d,b,x,p,v,m;let o="",i=0,n=0,s=!0,f=!1;const g=l.getSelectedText(),u=(d=a.configOption.editorConfig)==null?void 0:d.mermaidTemplate;if(/^h[1-6]{1}$/.test(t)){const k=t.replace(/^h(\d)/,(V,N)=>new Array(Number(N)).fill("#",0,N).join(""));o=`${k} ${g}`,i=k.length+1}else if(t==="prettier"){const k=window.prettier||((x=(b=a.configOption.editorExtensions)==null?void 0:b.prettier)==null?void 0:x.prettierInstance),V=[((p=window.prettierPlugins)==null?void 0:p.markdown)||((m=(v=a.configOption.editorExtensions)==null?void 0:v.prettier)==null?void 0:m.parserMarkdownInstance)];!k||V[0]===void 0?(h.bus.emit(r.editorId,"errorCatcher",{name:"prettier",message:"prettier is undefined"}),o=l.getValue()):o=k.format(l.getValue(),{parser:"markdown",plugins:V}),s=!1,f=!0}else switch(t){case"bold":{o=`**${g}**`,i=2,n=-2;break}case"underline":{o=`<u>${g}</u>`,i=3,n=-4;break}case"italic":{o=`*${g}*`,i=1,n=-1;break}case"strikeThrough":{o=`~~${g}~~`,i=2,n=-2;break}case"sub":{o=`<sub>${g}</sub>`,i=5,n=-6;break}case"sup":{o=`<sup>${g}</sup>`,i=5,n=-6;break}case"codeRow":{o="`"+g+"`",i=1,n=-1;break}case"quote":{o=`> ${g}`,i=2;break}case"orderedList":{o=`1. ${g}`,i=3;break}case"unorderedList":{o=`- ${g}`,i=2;break}case"task":{o=`- [ ] ${g}`,i=6;break}case"code":{const k=r.text||g||"",V=r.mode||"language";o=`\`\`\`${V}
${k}
\`\`\`
`,i=3,n=3+V.length-o.length;break}case"table":{o="|";const{selectedShape:k={x:1,y:1}}=r,{x:V,y:N}=k;for(let y=0;y<=N;y++)o+=" col |";o+=`
|`;for(let y=0;y<=N;y++)o+=" - |";for(let y=0;y<=V;y++){o+=`
|`;for(let T=0;T<=N;T++)o+=" content |"}i=2,n=5-o.length;break}case"link":{const{desc:k,url:V}=r;o=`[${k}](${V})`,s=!1;break}case"image":{const{desc:k,url:V,urls:N}=r;N instanceof Array?o=N.reduce((y,T)=>y+`![${k}](${T})
`,""):o=`![${k}](${V})
`,s=!1;break}case"flow":{o=`\`\`\`mermaid
${(u==null?void 0:u.flow)||`flowchart TD 
  Start --> Stop`}
\`\`\`
`,i=3,n=10-o.length;break}case"sequence":{o=`\`\`\`mermaid
${(u==null?void 0:u.sequence)||`sequenceDiagram
  A->>B: hello!
  B-->>A: hi!
  A-)B: bye!`}
\`\`\`
`,i=3,n=10-o.length;break}case"gantt":{o=`\`\`\`mermaid
${(u==null?void 0:u.gantt)||`gantt
title A Gantt Diagram
dateFormat  YYYY-MM-DD
section Section
A task  :a1, 2014-01-01, 30d
Another task  :after a1, 20d`}
\`\`\`
`,i=3,n=10-o.length;break}case"class":{o=`\`\`\`mermaid
${(u==null?void 0:u.class)||`classDiagram
  class Animal
  Vehicle <|-- Car`}
\`\`\`
`,i=3,n=10-o.length;break}case"state":{o=`\`\`\`mermaid
${(u==null?void 0:u.state)||`stateDiagram-v2
  s1 --> s2`}
\`\`\`
`,i=3,n=10-o.length;break}case"pie":{o=`\`\`\`mermaid
${(u==null?void 0:u.pie)||`pie title Pets adopted by volunteers
  "Dogs" : 386
  "Cats" : 85
  "Rats" : 15`}
\`\`\`
`,i=3,n=10-o.length;break}case"relationship":{o=`\`\`\`mermaid
${(u==null?void 0:u.relationship)||`erDiagram
  CAR ||--o{ NAMED-DRIVER : allows
  PERSON ||--o{ NAMED-DRIVER : is`}
\`\`\`
`,i=3,n=10-o.length;break}case"journey":{o=`\`\`\`mermaid
${(u==null?void 0:u.journey)||`journey
  title My working day
  section Go to work
    Make tea: 5: Me
    Go upstairs: 3: Me
    Do work: 1: Me, Cat
  section Go home
    Go downstairs: 5: Me
    Sit down: 5: Me`}
\`\`\`
`,i=3,n=10-o.length;break}case"katexInline":{o="$$",i=1,n=-1;break}case"katexBlock":{o=`$$

$$
`,i=3,n=-4;break}case"universal":{const{generate:k}=r,V=k(g);o=V.targetValue,s=V.select,i=V.deviationStart,n=V.deviationEnd}}return{text:o,options:{select:s,deviationStart:i,deviationEnd:n,replaceAll:f}}},st="#e5c07b",we="var(--md-color)",dt="#56b6c2",ut="#ffffff",Z="var(--md-color)",Se="#e5c07b",ft="#e5c07b",gt="var(--md-color)",Te="#d19a66",mt="#c678dd",ht="#21252b",pt="#2c313a",Ae="var(--md-bk-color)",ne="var(--md-bk-color)",bt="#ceedfa33",Me="#528bff",vt=Q.EditorView.theme({"&":{color:Z,backgroundColor:Ae},".cm-content":{caretColor:Me},".cm-cursor, .cm-dropCursor":{borderLeftColor:Me},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:bt},".cm-panels":{backgroundColor:ht,color:Z},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:Ae,color:Z,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:pt},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:ne},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:ne,borderBottomColor:ne},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:Z}}},{dark:!0}),kt=ee.HighlightStyle.define([{tag:c.tags.keyword,color:mt},{tag:[c.tags.name,c.tags.deleted,c.tags.character,c.tags.propertyName,c.tags.macroName],color:we},{tag:[c.tags.function(c.tags.variableName),c.tags.labelName],color:ft},{tag:[c.tags.color,c.tags.constant(c.tags.name),c.tags.standard(c.tags.name)],color:Te},{tag:[c.tags.definition(c.tags.name),c.tags.separator],color:Z},{tag:[c.tags.typeName,c.tags.className,c.tags.number,c.tags.changed,c.tags.annotation,c.tags.modifier,c.tags.self,c.tags.namespace],color:st},{tag:[c.tags.operator,c.tags.operatorKeyword,c.tags.url,c.tags.escape,c.tags.regexp,c.tags.link,c.tags.special(c.tags.string)],color:dt},{tag:[c.tags.meta,c.tags.comment],color:Se},{tag:c.tags.strong,fontWeight:"bold"},{tag:c.tags.emphasis,fontStyle:"italic"},{tag:c.tags.strikethrough,textDecoration:"line-through"},{tag:c.tags.link,color:Se,textDecoration:"underline"},{tag:c.tags.heading,fontWeight:"bold",color:we},{tag:[c.tags.atom,c.tags.bool,c.tags.special(c.tags.variableName)],color:Te},{tag:[c.tags.processingInstruction,c.tags.string,c.tags.inserted],color:gt},{tag:c.tags.invalid,color:ut}]),xt=[vt,ee.syntaxHighlighting(kt)],Ct="#e5c07b",Ee="#3f4a54",$t="#56b6c2",Vt="#fff",J="#3f4a54",De="#2d8cf0",yt="#2d8cf0",Nt="#3f4a54",Le="#d19a66",wt="#c678dd",St="#21252b",Tt="#ceedfa33",He="var(--md-bk-color)",ie="var(--md-bk-color)",At="#bad5fa",Ie="#3f4a54",Mt=Q.EditorView.theme({"&":{color:J,backgroundColor:He},".cm-content":{caretColor:Ie},".cm-cursor, .cm-dropCursor":{borderLeftColor:Ie},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:At},".cm-panels":{backgroundColor:St,color:J},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:He,color:J,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:Tt},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:ie},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:ie,borderBottomColor:ie},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:J}}}),Et=ee.HighlightStyle.define([{tag:c.tags.keyword,color:wt},{tag:[c.tags.name,c.tags.deleted,c.tags.character,c.tags.propertyName,c.tags.macroName],color:Ee},{tag:[c.tags.function(c.tags.variableName),c.tags.labelName],color:yt},{tag:[c.tags.color,c.tags.constant(c.tags.name),c.tags.standard(c.tags.name)],color:Le},{tag:[c.tags.definition(c.tags.name),c.tags.separator],color:J},{tag:[c.tags.typeName,c.tags.className,c.tags.number,c.tags.changed,c.tags.annotation,c.tags.modifier,c.tags.self,c.tags.namespace],color:Ct},{tag:[c.tags.operator,c.tags.operatorKeyword,c.tags.url,c.tags.escape,c.tags.regexp,c.tags.link,c.tags.special(c.tags.string)],color:$t},{tag:[c.tags.meta,c.tags.comment],color:De},{tag:c.tags.strong,fontWeight:"bold"},{tag:c.tags.emphasis,fontStyle:"italic"},{tag:c.tags.strikethrough,textDecoration:"line-through"},{tag:c.tags.link,color:De,textDecoration:"underline"},{tag:c.tags.heading,fontWeight:"bold",color:Ee},{tag:[c.tags.atom,c.tags.bool,c.tags.special(c.tags.variableName)],color:Le},{tag:[c.tags.processingInstruction,c.tags.string,c.tags.inserted],color:Nt},{tag:c.tags.invalid,color:Vt}]),Dt=[Mt,ee.syntaxHighlighting(Et)],le=(t,l,r,o,i)=>(n,s,f,g)=>{const u=`${t}${l}`.slice(g-f);n.dispatch(n.state.replaceSelection(`${u}${r}${o}`));const d=f+s.label.length+(i==="title"?r.length:0);n.dispatch({selection:A.EditorSelection.create([A.EditorSelection.range(f+s.label.length+(i==="title"?1:-l.length),d),A.EditorSelection.cursor(d)],1)}),n.focus()},Be=t=>(l,r,o,i)=>{const n=t.slice(i-o);l.dispatch(l.state.replaceSelection(`${n} `))},Lt=t=>{const l=r=>{const o=r.matchBefore(/^#+|^-\s*\[*\s*\]*|`+|\[|!\[*|^\|\s?\|?|^\$\$?|!+\s*\w*/);return o===null||o.from==o.to&&r.explicit?null:{from:o.from,options:[...["h1","h2","h3","h4","h5","h6"].map((i,n)=>{const s=new Array(n+1).fill("#").join("");return{label:s,type:"text",apply:Be(s)}}),...["unchecked","checked"].map(i=>{const n=i==="checked"?"- [x]":"- [ ]";return{label:n,type:"text",apply:Be(n)}}),...[["`",""],["```","language"],["```mermaid\n",""]].map(i=>({label:`${i[0]}${i[1]}`,type:"text",apply:le(i[0],i[1],"",i[0]==="`"?"`":"\n```","type")})),{label:"[]()",type:"text"},{label:"![]()",type:"text"},{label:"| |",type:"text",detail:"table",apply:`| col | col | col |
| - | - | - |
| content | content | content |
| content | content | content |`},{label:"$",type:"text",apply:le("$","","","$","type")},{label:"$$",type:"text",apply:le("$$","",`
`,`
$$`,"title")},...["note","abstract","info","tip","success","question","warning","failure","danger","bug","example","quote","hint","caution","error","attention"].map(i=>({label:`!!! ${i}`,type:"text",apply:le("!!!",` ${i}`," Title",`

!!!`,"title")}))]}};return Ge.autocompletion({override:t?[l,...t]:[l]})},Ht=Lt,U=t=>{const l=new A.Compartment;return o=>(l.get(t.state)?t.dispatch({effects:l.reconfigure(o)}):t.dispatch({effects:A.StateEffect.appendConfig.of(l.of(o))}),!0)};class It{constructor(l){R(this,"view");R(this,"toggleTabSize");R(this,"togglePlaceholder");R(this,"setExtensions");R(this,"toggleDisabled");R(this,"toggleReadOnly");R(this,"toggleMaxlength");this.view=l,this.toggleTabSize=U(this.view),this.togglePlaceholder=U(this.view),this.setExtensions=U(this.view),this.toggleDisabled=U(this.view),this.toggleReadOnly=U(this.view),this.toggleMaxlength=U(this.view)}getValue(){return this.view.state.doc.toString()}setValue(l,r=0,o=this.view.state.doc.length){this.view.dispatch({changes:{from:r,to:o,insert:l}})}getSelectedText(){const{from:l,to:r}=this.view.state.selection.main;return this.view.state.sliceDoc(l,r)}replaceSelectedText(l,r={select:!0,deviationStart:0,deviationEnd:0,replaceAll:!1}){if(r.replaceAll){this.setValue(l);return}const{from:o}=this.view.state.selection.main;if(this.view.dispatch(this.view.state.replaceSelection(l)),r.select){const i=o+l.length+r.deviationEnd;this.view.dispatch({selection:A.EditorSelection.create([A.EditorSelection.range(o+r.deviationStart,i),A.EditorSelection.cursor(i)],1)})}this.view.focus()}setTabSize(l){this.toggleTabSize([A.EditorState.tabSize.of(l),ee.indentUnit.of(" ".repeat(l))])}setPlaceholder(l){this.togglePlaceholder(Q.placeholder(l))}focus(l){if(this.view.focus(),!l)return;let r=0,o=0,i=0;switch(l){case"start":break;case"end":{r=o=i=this.getValue().length;break}default:r=l.rangeAnchor||l.cursorPos,o=l.rangeHead||l.cursorPos,i=l.cursorPos}this.view.dispatch({scrollIntoView:!0,selection:A.EditorSelection.create([A.EditorSelection.range(r,o),A.EditorSelection.cursor(i)],1)})}setDisabled(l){this.toggleDisabled([Q.EditorView.editable.of(!l)])}setReadOnly(l){this.toggleReadOnly([A.EditorState.readOnly.of(l)])}setMaxLength(l){this.toggleMaxlength([A.EditorState.changeFilter.of(r=>r.newDoc.length<=l)])}}const Bt=t=>{const l=e.inject("editorId");return o=>{if(o.clipboardData){if(o.clipboardData.files.length>0){const{files:i}=o.clipboardData;h.bus.emit(l,"uploadImage",Array.from(i).filter(n=>/image\/.*/.test(n.type))),o.preventDefault()}if(t.autoDetectCode&&o.clipboardData.types.includes("vscode-editor-data")){const i=JSON.parse(o.clipboardData.getData("vscode-editor-data"));h.bus.emit(l,"replace","code",{mode:i.mode,text:o.clipboardData.getData("text/plain")}),o.preventDefault()}}}},Ft=Bt,Ot=t=>{const l=e.inject("editorId");e.onMounted(()=>{h.bus.on(l,{name:S.TEXTAREA_FOCUS,callback(r){var o;(o=t.value)==null||o.focus(r)}})})},qt=Ot,Rt=(t,l)=>{const r={key:"Ctrl-b",mac:"Cmd-b",run:()=>(h.bus.emit(t,"replace","bold"),!0)},o={key:"Ctrl-s",mac:"Cmd-s",run:T=>(h.bus.emit(t,S.ON_SAVE,T.state.doc.toString()),!0),shift:()=>(h.bus.emit(t,"replace","strikeThrough"),!0)},i={key:"Ctrl-u",mac:"Cmd-u",run:()=>(h.bus.emit(t,"replace","underline"),!0),shift:()=>(h.bus.emit(t,"replace","unorderedList"),!0)},n={key:"Ctrl-i",mac:"Cmd-i",run:()=>(h.bus.emit(t,"replace","italic"),!0),shift:()=>(h.bus.emit(t,"openModals","image"),!0)},s={key:"Ctrl-1",mac:"Cmd-1",run:()=>(h.bus.emit(t,"replace","h1"),!0)},f={key:"Ctrl-2",mac:"Cmd-2",run:()=>(h.bus.emit(t,"replace","h2"),!0)},g={key:"Ctrl-3",mac:"Cmd-3",run:()=>(h.bus.emit(t,"replace","h3"),!0)},u={key:"Ctrl-4",mac:"Cmd-4",run:()=>(h.bus.emit(t,"replace","h4"),!0)},d={key:"Ctrl-5",mac:"Cmd-5",run:()=>(h.bus.emit(t,"replace","h5"),!0)},b={key:"Ctrl-6",mac:"Cmd-6",run:()=>(h.bus.emit(t,"replace","h6"),!0)},x={key:"Ctrl-ArrowUp",mac:"Cmd-ArrowUp",run:()=>(h.bus.emit(t,"replace","sup"),!0)},p={key:"Ctrl-ArrowDown",mac:"Cmd-ArrowDown",run:()=>(h.bus.emit(t,"replace","sub"),!0)},v={key:"Ctrl-o",mac:"Cmd-o",run:()=>(h.bus.emit(t,"replace","orderedList"),!0)},m={key:"Ctrl-c",mac:"Cmd-c",shift:()=>(h.bus.emit(t,"replace","code"),!0),any(T,C){return(C.ctrlKey||C.metaKey)&&C.altKey&&C.code==="KeyC"?(h.bus.emit(t,"replace","codeRow"),!0):!1}},k={key:"Ctrl-l",mac:"Cmd-l",run:()=>(h.bus.emit(t,"openModals","link"),!0)},V={key:"Ctrl-f",mac:"Cmd-f",shift:()=>l.noPrettier?!1:(h.bus.emit(t,"replace","prettier"),!0)},N={any:(T,C)=>(C.ctrlKey||C.metaKey)&&C.altKey&&C.shiftKey&&C.code==="KeyT"?(h.bus.emit(t,"replace","table"),!0):!1},y={key:"Ctrl-d",mac:"Cmd-d",run:ae.deleteLine,preventDefault:!0};return[r,y,o,i,n,s,f,g,u,d,b,x,p,v,m,k,V,N]},Pt=Rt,jt=t=>{const l=e.inject("tabWidth"),r=e.inject("editorId"),o=e.inject("theme"),i=e.ref(),n=e.shallowRef(),s=Pt(r,t),f=Ft(t),g=[Q.keymap.of([...s,ae.indentWithTab]),Y.minimalSetup,je.markdown({codeLanguages:Pe.languages}),Y.EditorView.lineWrapping,Y.EditorView.updateListener.of(d=>{d.docChanged&&t.onChange(d.state.doc.toString())}),Y.EditorView.domEventHandlers({paste:f,blur:t.onBlur,focus:t.onFocus})],u=()=>{const d=[...g,o.value==="light"?Dt:xt,Ht(t.completions)];return a.configOption.codeMirrorExtensions(o.value,d,[...s])};return e.onMounted(()=>{const d=new Y.EditorView({doc:t.value,parent:i.value}),b=new It(d);n.value=b,setTimeout(()=>{b.setTabSize(l),b.setDisabled(t.disabled),b.setReadOnly(t.readonly),b.setExtensions(u()),t.placeholder&&b.setPlaceholder(t.placeholder),typeof t.maxlength=="number"&&b.setMaxLength(t.maxlength),t.autofocus&&d.focus()},0),h.bus.on(r,{name:"ctrlZ",callback(){ae.undo(d)}}),h.bus.on(r,{name:"ctrlShiftZ",callback(){ae.redo(d)}}),h.bus.on(r,{name:"replace",callback(x,p={}){var k;const{text:v,options:m}=ct(x,n.value,p);(k=n.value)==null||k.replaceSelectedText(v,m)}})}),e.watch([o,e.toRef(t,"completions")],()=>{var d;(d=n.value)==null||d.setExtensions(u())},{deep:!0}),e.watch(()=>t.value,()=>{var d,b;((d=n.value)==null?void 0:d.getValue())!==t.value&&((b=n.value)==null||b.setValue(t.value))}),e.watch(()=>t.placeholder,()=>{var d;(d=n.value)==null||d.setPlaceholder(t.placeholder)}),e.watch(()=>t.disabled,()=>{var d;(d=n.value)==null||d.setDisabled(t.disabled)}),e.watch(()=>t.readonly,()=>{var d;(d=n.value)==null||d.setDisabled(t.readonly)}),e.watch(()=>t.maxlength,()=>{var d;t.maxlength&&((d=n.value)==null||d.setMaxLength(t.maxlength))}),qt(n),{inputWrapperRef:i,codeMirrorUt:n}},Gt=jt,Ut={value:{type:String,default:""},onChange:{type:Function,default:()=>{}},setting:{type:Object,default:()=>({})},onHtmlChanged:{type:Function,default:()=>{}},onGetCatalog:{type:Function,default:()=>{}},mdHeadingId:{type:Function,default:()=>""},noMermaid:{type:Boolean,default:!1},sanitize:{type:Function,default:t=>t},placeholder:{type:String,default:""},noKatex:{type:Boolean,default:!1},scrollAuto:{type:Boolean},formatCopiedText:{type:Function,default:t=>t},autofocus:{type:Boolean},disabled:{type:Boolean},readonly:{type:Boolean},maxlength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function,default:()=>{}},onFocus:{type:Function,default:()=>{}},noPrettier:{type:Boolean},noHighlight:{type:Boolean,default:!1},completions:{type:Array},catalogVisible:{type:Boolean},theme:{type:String,default:"light"}},Kt=e.defineComponent({name:"MDEditorContent",props:Ut,setup(t){const l=e.inject("editorId"),r=e.ref(""),{inputWrapperRef:o,codeMirrorUt:i}=Gt(t);return it(t,r,i),()=>e.createVNode("div",{class:`${a.prefix}-content`},[e.createVNode("div",{class:`${a.prefix}-input-wrapper`,ref:o},null),e.createVNode(S.ContentPreview,{modelValue:t.value,setting:t.setting,onHtmlChanged:n=>{r.value=n,t.onHtmlChanged(n)},onGetCatalog:t.onGetCatalog,mdHeadingId:t.mdHeadingId,noMermaid:t.noMermaid,sanitize:t.sanitize,noKatex:t.noKatex,formatCopiedText:t.formatCopiedText,noHighlight:t.noHighlight},null),t.catalogVisible&&e.createVNode(Fe,{theme:t.theme,class:`${a.prefix}-catalog-editor`,editorId:l,mdHeadingId:t.mdHeadingId,key:"internal-catalog"},null)])}}),_t=e.defineComponent({props:{modelValue:{type:String,default:""}},setup(t){const l=e.inject("usedLanguageText");return()=>{var r,o;return e.createVNode("div",{class:`${a.prefix}-footer-item`},[e.createVNode("label",{class:`${a.prefix}-footer-label`},[`${(r=l.value.footer)==null?void 0:r.markdownTotal}:`]),e.createVNode("span",null,[((o=t.modelValue)==null?void 0:o.length)||0])])}}}),Wt={checked:{type:Boolean,default:!1},onChange:{type:Function,default:()=>{}}},zt=e.defineComponent({props:Wt,setup(t){return()=>e.createVNode("div",{class:[`${a.prefix}-checkbox`,t.checked&&`${a.prefix}-checkbox-checked`],onClick:()=>{t.onChange(!t.checked)}},null)}}),Yt={scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}}},Zt=e.defineComponent({props:Yt,setup(t){const l=e.inject("usedLanguageText");return()=>{var r;return e.createVNode("div",{class:`${a.prefix}-footer-item`},[e.createVNode("label",{class:`${a.prefix}-footer-label`,onClick:()=>{t.onScrollAutoChange(!t.scrollAuto)}},[(r=l.value.footer)==null?void 0:r.scrollAuto]),e.createVNode(zt,{checked:t.scrollAuto,onChange:t.onScrollAutoChange},null)])}}}),Jt={modelValue:{type:String,default:""},footers:{type:Array,default:[]},scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}},defFooters:{type:Object}},Xt=e.defineComponent({name:"MDEditorFooter",props:Jt,setup(t){const l=e.computed(()=>{const o=t.footers.indexOf("="),i=o===-1?t.footers:t.footers.slice(0,o),n=o===-1?[]:t.footers.slice(o,Number.MAX_SAFE_INTEGER);return[i,n]}),r=o=>{if(a.allFooter.includes(o))switch(o){case"markdownTotal":return e.createVNode(_t,{modelValue:t.modelValue},null);case"scrollSwitch":return e.createVNode(Zt,{scrollAuto:t.scrollAuto,onScrollAutoChange:t.onScrollAutoChange},null)}else return t.defFooters instanceof Array?t.defFooters[o]||"":t.defFooters&&t.defFooters.children instanceof Array&&t.defFooters.children[o]||""};return()=>{const o=l.value[0].map(n=>r(n)),i=l.value[1].map(n=>r(n));return e.createVNode("div",{class:`${a.prefix}-footer`},[e.createVNode("div",{class:`${a.prefix}-footer-left`},[o]),e.createVNode("div",{class:`${a.prefix}-footer-right`},[i])])}}}),Qt=e.defineComponent({name:"MdEditorV3",props:S.editorProps,emits:S.editorEmits,setup(t,l){const{editorId:r,noKatex:o,noMermaid:i,noPrettier:n,noUploadImg:s,noHighlight:f}=t,g=e.reactive({scrollAuto:t.scrollAuto});S.useOnSave(t,l),S.useProvide(t),S.useExpansion(t);const[u,d]=S.useConfig(t,l),b=S.useCatalog(t);return e.onBeforeUnmount(()=>{h.bus.clear(r)}),S.useExpose(t,l,b,u,d),()=>{var v;const x=Ne.getSlot({props:t,ctx:l},"defToolbars"),p=Ne.getSlot({props:t,ctx:l},"defFooters");return e.createVNode("div",{id:r,class:[a.prefix,t.class,t.theme==="dark"&&`${a.prefix}-dark`,u.fullscreen||u.pageFullscreen?`${a.prefix}-fullscreen`:""],style:t.style},[e.createVNode(lt,{noPrettier:n,toolbars:t.toolbars,toolbarsExclude:t.toolbarsExclude,setting:u,updateSetting:d,tableShape:t.tableShape,defToolbars:x,noUploadImg:s},null),e.createVNode(Kt,{value:t.modelValue,setting:u,mdHeadingId:t.mdHeadingId,noMermaid:i,noPrettier:n,sanitize:t.sanitize,placeholder:t.placeholder,noKatex:o,scrollAuto:g.scrollAuto,formatCopiedText:t.formatCopiedText,autofocus:t.autoFocus,disabled:t.disabled,readonly:t.readOnly,maxlength:t.maxLength,autoDetectCode:t.autoDetectCode,noHighlight:f,onChange:m=>{t.onChange?t.onChange(m):(l.emit("update:modelValue",m),l.emit("onChange",m))},onHtmlChanged:m=>{t.onHtmlChanged?t.onHtmlChanged(m):l.emit("onHtmlChanged",m)},onGetCatalog:m=>{t.onGetCatalog?t.onGetCatalog(m):l.emit("onGetCatalog",m)},onBlur:m=>{t.onBlur?t.onBlur(m):l.emit("onBlur",m)},onFocus:m=>{t.onFocus?t.onFocus(m):l.emit("onFocus",m)},completions:t.completions,catalogVisible:b.value,theme:t.theme},null),((v=t.footers)==null?void 0:v.length)>0&&e.createVNode(Xt,{modelValue:t.modelValue,footers:t.footers,defFooters:p,scrollAuto:g.scrollAuto,onScrollAutoChange:m=>g.scrollAuto=m},null)])}}}),re=Qt;re.install=t=>(t.component(re.name,re),t.use(Ue).use(K.DropdownToolbar).use(ce.ModalToolbar).use(Fe).use(S.MdPreview),t);module.exports=re;
