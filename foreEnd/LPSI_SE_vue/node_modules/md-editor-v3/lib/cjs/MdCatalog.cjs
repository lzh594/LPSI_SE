"use strict";const n=require("vue"),h=require("./chunks/config.cjs"),g=require("./chunks/index4.cjs"),C={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},I=n.defineComponent({props:C,setup(l){return()=>{const{tocItem:o,mdHeadingId:m,scrollElement:c,onClick:f,scrollElementOffsetTop:E}=l;return n.createVNode("div",{class:[`${h.prefix}-catalog-link`,o.active&&`${h.prefix}-catalog-active`],onClick:i=>{f(i,o),i.stopPropagation();const p=m(o.text,o.level,o.index),a=document.getElementById(p),t=c instanceof Element?c:document.querySelector(c);if(a&&t){let e=a.offsetParent,s=a.offsetTop;if(t.contains(e))for(;e&&t!=e;)s+=e==null?void 0:e.offsetTop,e=e==null?void 0:e.offsetParent;t==null||t.scrollTo({top:s-E,behavior:"smooth"})}}},[n.createVNode("span",{title:o.text},[o.text]),n.createVNode("div",{class:`${h.prefix}-catalog-wrapper`},[o.children&&o.children.map(i=>n.createVNode(I,{mdHeadingId:m,key:`${o.text}-link-${i.level}-${i.text}`,tocItem:i,scrollElement:c,onClick:f,scrollElementOffsetTop:E},null))])])}}}),H=I,x={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:l=>l},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},$=n.defineComponent({name:"MdCatalog",props:x,emits:["onClick","onActive"],setup(l,o){const m=l.editorId,c=n.reactive({list:[],show:!1,scrollElement:l.scrollElement||`#${m}-preview-wrapper`}),f=n.shallowRef(),E=n.computed(()=>{const t=[];return c.list.forEach((e,s)=>{const{text:v,level:y}=e,r={level:y,text:v,index:s+1,active:f.value===e};if(t.length===0)t.push(r);else{let d=t[t.length-1];if(r.level>d.level)for(let u=d.level+1;u<=6;u++){const{children:T}=d;if(!T){d.children=[r];break}if(d=T[T.length-1],r.level<=d.level){T.push(r);break}}else t.push(r)}}),t}),i=()=>c.scrollElement instanceof HTMLElement?c.scrollElement:document.querySelector(c.scrollElement),p=t=>{if(t.length===0)return c.list=[],!1;const{activeHead:e}=t.reduce((s,v,y)=>{const r=document.getElementById(l.mdHeadingId(v.text,v.level,y+1));if(r instanceof HTMLElement){const d=i(),u=g.getRelativeTop(r,d);if(u<l.offsetTop&&u>s.minTop)return{activeHead:v,minTop:u}}return s},{activeHead:t[0],minTop:Number.MIN_SAFE_INTEGER});f.value=e,c.list=t},a=()=>{p(c.list)};return n.watch(()=>f.value,t=>{const e=t?{...t}:void 0;l.onActive?l.onActive(e):o.emit("onActive",e)}),n.onMounted(()=>{const t=i(),e=t===document.documentElement?window:t;e==null||e.addEventListener("scroll",a),g.bus.on(m,{name:g.CATALOG_CHANGED,callback:s=>{e==null||e.removeEventListener("scroll",a),p(s),e==null||e.addEventListener("scroll",a)}}),g.bus.emit(m,g.PUSH_CATALOG)}),n.onBeforeUnmount(()=>{var e;const t=i();(e=t===document.documentElement?window:t)==null||e.removeEventListener("scroll",a)}),()=>n.createVNode("div",{class:`${h.prefix}-catalog${l.theme==="dark"?"-dark":""} ${l.class}`},[E.value.map(t=>n.createVNode(H,{mdHeadingId:l.mdHeadingId,tocItem:t,key:`link-${t.level}-${t.text}`,scrollElement:c.scrollElement,onClick:(e,s)=>{l.onClick?l.onClick(e,s):o.emit("onClick",e,s)},scrollElementOffsetTop:l.scrollElementOffsetTop},null))])}}),k=$;k.install=l=>(l.component(k.name,k),l);module.exports=k;
