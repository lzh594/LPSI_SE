"use strict";const c=require("vue"),d=require("./config.cjs"),p=require("./index4.cjs"),E=require("./dom.cjs"),O=require("medium-zoom"),A=require("@vavt/util"),G=require("copy-to-clipboard"),j=require("markdown-it"),D=require("markdown-it-image-figures"),U=require("markdown-it-task-lists"),V=require("lru-cache"),q=(e,i)=>{const l=c.inject("editorId"),{noImgZoomIn:t}=e,n=A.debounce(()=>{const r=document.querySelectorAll(`#${l}-preview img`);r.length!==0&&O(r,{background:"#00000073"})});c.onMounted(()=>{!t&&n()}),c.watch([i,c.toRef(e.setting,"preview")],()=>{!t&&n()})},W=q,z=(e,i)=>{if(typeof i[e]=="string")return i[e];const l=`<i class="${d.prefix}-iconfont ${d.prefix}-icon-${e}"></i>`;switch(d.configOption.iconfontType){case"svg":return`<svg class="${d.prefix}-icon" aria-hidden="true"><use xlink:href="#${d.prefix}-icon-${e}"></use></svg>`;default:return l}},K=(e,i)=>{const l=c.inject("editorId"),t=c.inject("usedLanguageText"),n=c.inject("customIcon"),r=()=>{document.querySelectorAll(`#${l}-preview pre`).forEach(m=>{var w,y;let u=-1;(w=m.querySelector(".copy-button"))==null||w.remove();const o=((y=t.value.copyCode)==null?void 0:y.text)||"复制代码",f=document.createElement("span");f.setAttribute("class","copy-button"),f.dataset.tips=o,f.innerHTML=z("copy",n.value),f.addEventListener("click",()=>{var b,C;clearTimeout(u);const h=m.querySelector("code").innerText,v=G(e.formatCopiedText(h)),g=((b=t.value.copyCode)==null?void 0:b.successTips)||"已复制！",k=((C=t.value.copyCode)==null?void 0:C.failTips)||"已复制！";f.dataset.tips=v?g:k,u=window.setTimeout(()=>{f.dataset.tips=o},1500)}),m.appendChild(f)})},a=()=>{c.nextTick(r)},s=m=>{m&&c.nextTick(r)};c.watch(()=>i.value,a),c.watch(()=>e.setting.preview,s),c.watch(()=>e.setting.htmlPreview,s),c.watch(()=>t.value,r),c.onMounted(r)},Z=K,J=e=>{var r;const i=(r=d.configOption.editorExtensions)==null?void 0:r.highlight,l=i==null?void 0:i.instance,t=c.inject("highlight"),n=c.shallowRef(l);return c.onMounted(()=>{if(!e.noHighlight&&!n.value){const a=document.createElement("script");a.src=t.value.js,a.onload=()=>{n.value=window.hljs},a.id=`${d.prefix}-hljs`,E.appendHandler(a,"hljs");const s=document.createElement("link");s.rel="stylesheet",s.href=t.value.css,s.id=`${d.prefix}-hlCss`,E.appendHandler(s)}}),c.watch(()=>t.value.css,a=>{E.updateHandler(`${d.prefix}-hlCss`,"href",a)}),n},X=J,Q=e=>{const i=c.inject("theme"),{editorExtensions:l}=d.configOption,t=l==null?void 0:l.mermaid,n=c.shallowRef(t==null?void 0:t.instance),r=c.shallowRef(-1),a=new V({max:1e3,ttl:6e5}),s=()=>{const u=n.value;!e.noMermaid&&u&&(u.initialize({startOnLoad:!1,theme:i.value==="dark"?"dark":"default"}),r.value=r.value+1)};return c.watch(()=>i.value,()=>{a.clear(),s()}),c.onMounted(()=>{if(!e.noMermaid&&!(t!=null&&t.instance)){const u=(t==null?void 0:t.js)||d.mermaidUrl;if(/\.mjs/.test(u))import(u).then(o=>{n.value=o.default,s()});else{const o=document.createElement("script");o.id=`${d.prefix}-mermaid`,o.src=u,o.onload=()=>{n.value=window.mermaid,s()},E.appendHandler(o,"mermaid")}}}),{mermaidRef:n,reRenderRef:r,replaceMermaid:()=>{c.nextTick(()=>{if(!e.noMermaid&&n.value){const u=document.querySelectorAll(`div.${d.prefix}-mermaid`),o=document.createElement("div");o.style.width=document.body.offsetWidth+"px",o.style.height=document.body.offsetHeight+"px",o.style.position="fixed",o.style.zIndex="-10000",o.style.top="-10000";let f=u.length;f>0&&document.body.appendChild(o),u.forEach(async w=>{let y=a.get(w.innerText);if(!y){const v=p.uuid(),g=n.value.renderAsync||n.value.render;let k="";try{k=await g(v,w.innerText,o)}catch{}y=typeof k=="string"?k:k.svg,a.set(w.innerText,y)}const h=document.createElement("p");h.className=`${d.prefix}-mermaid`,h.setAttribute("data-processed",""),h.innerHTML=y,w.dataset.line!==void 0&&(h.dataset.line=w.dataset.line),w.replaceWith(h),--f===0&&o.remove()})}})}}},Y=Q,ee=e=>{var n;const i=(n=d.configOption.editorExtensions)==null?void 0:n.katex,l=i==null?void 0:i.instance,t=c.shallowRef(l);return c.onMounted(()=>{if(!e.noKatex&&!t.value){const r=document.createElement("script");r.src=(i==null?void 0:i.js)||d.katexUrl.js,r.onload=()=>{t.value=window.katex},r.id=`${d.prefix}-katex`;const a=document.createElement("link");a.rel="stylesheet",a.href=(i==null?void 0:i.css)||d.katexUrl.css,a.id=`${d.prefix}-katexCss`,E.appendHandler(r,"katex"),E.appendHandler(a)}}),t},te=ee,ne=(e,i)=>{const l=e.renderer.rules.fence.bind(e.renderer.rules);e.renderer.rules.fence=(t,n,r,a,s)=>{const m=t[n],u=m.content.trim();if(m.info==="mermaid"){let o;return t[n].map&&t[n].level===0&&(o=t[n].map[0],t[n].attrSet("data-line",String(o))),`<div class="${d.prefix}-mermaid" ${o!==void 0?"data-line="+o:""} data-mermaid-theme=${i.themeRef.value}>${u}</div>`}return l(t,n,r,a,s)}},oe=ne,T=(e,i)=>{let l=!0,t=!0;const n=e.posMax,r=i>0?e.src.charCodeAt(i-1):-1,a=i+1<=n?e.src.charCodeAt(i+1):-1;return(r===32||r===9||a>=48&&a<=57)&&(t=!1),(a===32||a===9)&&(l=!1),{can_open:l,can_close:t}},re=(e,i)=>{let l,t,n,r;if(e.src[e.pos]!=="$")return!1;if(n=T(e,e.pos),!n.can_open)return i||(e.pending+="$"),e.pos+=1,!0;const a=e.pos+1;for(l=a;(l=e.src.indexOf("$",l))!==-1;){for(r=l-1;e.src[r]==="\\";)r-=1;if((l-r)%2==1)break;l+=1}return l===-1?(i||(e.pending+="$"),e.pos=a,!0):l-a===0?(i||(e.pending+="$$"),e.pos=a+1,!0):(n=T(e,l),n.can_close?(i||(t=e.push("math_inline","math",0),t.markup="$",t.content=e.src.slice(a,l)),e.pos=l+1,!0):(i||(e.pending+="$"),e.pos=a,!0))},ie=(e,i,l,t)=>{let n,r,a,s,m=!1,u=e.bMarks[i]+e.tShift[i],o=e.eMarks[i];if(u+2>o||e.src.slice(u,u+2)!=="$$")return!1;if(u+=2,n=e.src.slice(u,o),t)return!0;for(n.trim().slice(-2)==="$$"&&(n=n.trim().slice(0,-2),m=!0),a=i;!m&&(a++,!(a>=l||(u=e.bMarks[a]+e.tShift[a],o=e.eMarks[a],u<o&&e.tShift[a]<e.blkIndent)));)e.src.slice(u,o).trim().slice(-2)==="$$"&&(s=e.src.slice(0,o).lastIndexOf("$$"),r=e.src.slice(u,s),m=!0);e.line=a+1;const f=e.push("math_block","math",0);return f.block=!0,f.content=(n&&n.trim()?n+`
`:"")+e.getLines(i+1,a,e.tShift[i],!0)+(r&&r.trim()?r:""),f.map=[i,e.line],f.markup="$$",!0},le=(e,i)=>{const l=n=>{if(i.katexRef.value){const r=i.katexRef.value.renderToString(n,{throwOnError:!1});return`<span class="${d.prefix}-katex-inline" data-processed>${r}</span>`}else return`<span class="${d.prefix}-katex-inline">${n}</span>`},t=(n,r)=>{if(i.katexRef.value){const a=i.katexRef.value.renderToString(n,{throwOnError:!1,displayMode:!0});return`<p class="${d.prefix}-katex-block" data-line=${r} data-processed>${a}</p>`}else return`<p class="${d.prefix}-katex-block" data-line=${r}>${n}</p>`};e.inline.ruler.after("escape","math_inline",re),e.block.ruler.after("blockquote","math_block",ie,{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.math_inline=(n,r)=>l(n[r].content),e.renderer.rules.math_block=(n,r)=>t(n[r].content,n[r].map[0])+`
`},ae=le,ce=(e,i)=>{i=i||{};const l=3,t=i.marker||"!",n=t.charCodeAt(0),r=t.length;let a="",s="";const m=(o,f,w,y,h)=>{const v=o[f];return v.type==="admonition_open"?(o[f].attrPush(["class",`${d.prefix}-admonition ${d.prefix}-admonition-${v.info}`]),o[f].attrSet("data-line",String(o[f].map[0]))):v.type==="admonition_title_open"&&o[f].attrPush(["class",`${d.prefix}-admonition-title`]),h.renderToken(o,f,w)},u=o=>{const f=o.trim().split(" ",2);s="",a=f[0],f.length>1&&(s=o.substring(a.length+2)),(s===""||!s)&&(s=a)};e.block.ruler.before("code","admonition",(o,f,w,y)=>{let h,v,g,k=!1,b=o.bMarks[f]+o.tShift[f],C=o.eMarks[f];if(n!==o.src.charCodeAt(b))return!1;for(h=b+1;h<=C&&t[(h-b)%r]===o.src[h];h++);const I=Math.floor((h-b)/r);if(I!==l)return!1;h-=(h-b)%r;const $=o.src.slice(b,h),x=o.src.slice(h,C);if(u(x),y)return!0;for(v=f;v++,!(v>=w||(b=o.bMarks[v]+o.tShift[v],C=o.eMarks[v],b<C&&o.sCount[v]<o.blkIndent));)if(n===o.src.charCodeAt(b)&&!(o.sCount[v]-o.blkIndent>=4)){for(h=b+1;h<=C&&t[(h-b)%r]===o.src[h];h++);if(!(Math.floor((h-b)/r)<I)&&(h-=(h-b)%r,h=o.skipSpaces(h),!(h<C))){k=!0;break}}const S=o.parentType,H=o.lineMax;return o.parentType="root",o.lineMax=v,g=o.push("admonition_open","div",1),g.markup=$,g.block=!0,g.info=a,g.map=[f,v],g=o.push("admonition_title_open","p",1),g.markup=$+" "+a,g.map=[f,v],g=o.push("inline","",0),g.content=s,g.map=[f,o.line-1],g.children=[],g=o.push("admonition_title_close","p",-1),g.markup=$+" "+a,o.md.block.tokenize(o,f+1,v),g=o.push("admonition_close","div",-1),g.markup=o.src.slice(b,h),g.block=!0,o.parentType=S,o.lineMax=H,o.line=v+(k?1:0),!0},{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.admonition_open=m,e.renderer.rules.admonition_title_open=m,e.renderer.rules.admonition_title_close=m,e.renderer.rules.admonition_close=m},se=ce,ue=(e,i)=>{e.renderer.rules.heading_open=(l,t)=>{var s;const n=l[t],r=((s=l[t+1].children)==null?void 0:s.reduce((m,u)=>m+(u.content||""),""))||"",a=n.markup.length;return i.headsRef.value.push({text:r,level:a}),n.map&&n.level===0&&(n.attrSet("data-line",String(n.map[0])),n.attrSet("id",i.mdHeadingId(r,a,i.headsRef.value.length))),e.renderer.renderToken(l,t,i)},e.renderer.rules.heading_close=(l,t,n,r,a)=>a.renderToken(l,t,n)},de=ue,pe=(e,i)=>{const l=e.renderer.rules.fence,t=e.utils.unescapeAll,n=/\[(\w*)(?::([\w ]*))?\]/;function r(u){return u.info?t(u.info).trim():""}function a(u){const o=r(u),[f=null,w=""]=(n.exec(o)||[]).slice(1);return[f,w]}function s(u){const o=r(u);return o?o.split(/(\s+)/g)[0]:""}const m=(u,o,f,w,y)=>{if(u[o].hidden)return"";const[h,v]=a(u[o]);if(h===null)return l(u,o,f,w,y);let g,k,b,C,I="",$="";for(let x=o;x<u.length&&(g=u[x],[k,b]=a(g),k===h);x++)g.info=g.info.replace(n,""),g.hidden=!0,C=x-o>0?"":" checked",I+=`<li><input type="radio" name="label-group-${i.editorId}-${o}"${C}><label for="group-${i.editorId}-${o}-tab-${x-o}" onclick="this.previousElementSibling.click()">${b||s(g)}</label></li>
`,$+=`<input type="radio" id="group-${i.editorId}-${o}-tab-${x-o}" name="group-${i.editorId}-${o}"${C}>
`+l(u,x,f,w,y);return`<div class="code-tabs">
<ul>
`+I+`</ul>
`+$+"</div>"};e.renderer.rules.fence=m},me=pe,fe=e=>{["paragraph_open","table_open","ordered_list_open","bullet_list_open","blockquote_open","hr","html_block","fence"].forEach(i=>{const l=e.renderer.rules[i];l?e.renderer.rules[i]=(t,n,r,a,s)=>{let m;const u=l(t,n,r,a,s);return t[n].map&&t[n].level===0&&!/^<!--/.test(u)?(m=t[n].map[0],u.replace(/^(<[^>]*)/,`$1 data-line="${m}"`)):u}:e.renderer.rules[i]=(t,n,r,a,s)=>{let m;return t[n].map&&t[n].level===0&&(m=t[n].map[0],t[n].attrSet("data-line",String(m))),s.renderToken(t,n,r)}})},he=(e,i)=>{const{editorConfig:l,markdownItConfig:t,markdownItPlugins:n}=d.configOption,r=c.inject("editorId"),a=c.inject("showCodeRowNumber"),s=c.inject("theme"),m=c.ref([]),u=X(e),o=te(e),{reRenderRef:f,replaceMermaid:w}=Y(e),y=j({html:!0,breaks:!0});t(y);const h=[{type:"katex",plugin:ae,options:{katexRef:o}},{type:"image",plugin:D,options:{figcaption:!0,classes:"md-zoom"}},{type:"admonition",plugin:se,options:{}},{type:"taskList",plugin:U,options:{}},{type:"heading",plugin:de,options:{mdHeadingId:e.mdHeadingId,headsRef:m}},{type:"codeTabs",plugin:me,options:{editorId:r}}];e.noMermaid||h.push({type:"mermaid",plugin:oe,options:{themeRef:s}}),n(h).forEach(I=>{y.use(I.plugin,I.options)});const v=y.options.highlight;y.set({highlight:(I,$,x)=>{if(v){const P=v(I,$,x);if(P)return P}let S;!e.noHighlight&&u.value?u.value.getLanguage($)?S=u.value.highlight(I,{language:$,ignoreIllegals:!0}).value:S=u.value.highlightAuto(I).value:S=y.utils.escapeHtml(I);const H=a?p.generateCodeRowNumber(S.replace(/^\n+|\n+$/g,"")):`<span class="code-block">${S.replace(/^\n+|\n+$/g,"")}</span>`;return`<pre><code class="language-${$}" language=${$}>${H}</code></pre>`}}),fe(y);const g=c.ref(e.sanitize(y.render(e.modelValue))),k=()=>{p.bus.emit(r,p.BUILD_FINISHED,g.value),e.onHtmlChanged(g.value),e.onGetCatalog(m.value),p.bus.emit(r,p.CATALOG_CHANGED,m.value),w()};c.onMounted(k);const b=A.debounce(async()=>{m.value=[],g.value=e.sanitize(y.render(e.modelValue)),k()},(l==null?void 0:l.renderDelay)!==void 0?l==null?void 0:l.renderDelay:i?0:500),C=c.computed(()=>(e.noKatex||o.value)&&(e.noHighlight||u.value));return c.watch([c.toRef(e,"modelValue"),C,f],b),c.onMounted(()=>{p.bus.on(r,{name:p.PUSH_CATALOG,callback(){p.bus.emit(r,p.CATALOG_CHANGED,m.value)}})}),{html:g}},ge=he,M={modelValue:{type:String,default:""},setting:{type:Object,default:()=>({})},onHtmlChanged:{type:Function,default:()=>{}},onGetCatalog:{type:Function,default:()=>{}},mdHeadingId:{type:Function,default:()=>""},noMermaid:{type:Boolean,default:!1},sanitize:{type:Function,default:e=>e},noKatex:{type:Boolean,default:!1},formatCopiedText:{type:Function,default:e=>e},noHighlight:{type:Boolean,default:!1},previewOnly:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean}},ve={...M,onChange:{type:Function,default:()=>{}},placeholder:{type:String,default:""},scrollAuto:{type:Boolean},autofocus:{type:Boolean},disabled:{type:Boolean},readonly:{type:Boolean},maxlength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function,default:()=>{}},onFocus:{type:Function,default:()=>{}},noPrettier:{type:Boolean},completions:{type:Array},catalogVisible:{type:Boolean},theme:{type:String,default:"light"},onInput:{type:Function},onDrop:{type:Function,default:()=>{}},inputBoxWitdh:{type:String},onInputBoxWitdhChange:{type:Function}},F=c.defineComponent({name:"ContentPreview",props:M,setup(e){const i=c.inject("editorId"),l=c.inject("previewTheme"),t=c.inject("showCodeRowNumber"),{html:n}=ge(e,e.previewOnly);return Z(e,n),W(e,n),()=>c.createVNode(c.Fragment,null,[c.createVNode("div",{id:`${i}-preview-wrapper`,class:`${d.prefix}-preview-wrapper`,"data-show":e.setting.preview,key:"content-preview-wrapper"},[c.createVNode("article",{id:`${i}-preview`,class:[`${d.prefix}-preview`,`${l==null?void 0:l.value}-theme`,t&&`${d.prefix}-scrn`],innerHTML:n.value},null)]),!e.previewOnly&&c.createVNode("div",{id:`${i}-html-wrapper`,class:`${d.prefix}-preview-wrapper`,"data-show":e.setting.htmlPreview,key:"html-preview-wrapper"},[c.createVNode("div",{class:`${d.prefix}-html`},[n.value])])])}}),ye=(e,i)=>{const{editorId:l}=e,t=c.reactive({buildFinished:!1,html:""});c.watch(()=>e.modelValue,()=>{t.buildFinished=!1}),c.onMounted(()=>{p.bus.on(l,{name:p.BUILD_FINISHED,callback(n){t.buildFinished=!0,t.html=n}}),p.bus.on(l,{name:p.ON_SAVE,callback(){const n=new Promise(r=>{if(t.buildFinished)r(t.html);else{const a=s=>{r(s),p.bus.remove(l,p.BUILD_FINISHED,a)};p.bus.on(l,{name:p.BUILD_FINISHED,callback:a})}});e.onSave?e.onSave(e.modelValue,n):i.emit("onSave",e.modelValue,n)}})})},R=e=>{var n,r;const{editorId:i}=e,l=(r=(n=d.configOption)==null?void 0:n.editorExtensions)==null?void 0:r.highlight;c.provide("editorId",i),c.provide("theme",c.computed(()=>e.theme)),c.provide("language",c.computed(()=>e.language)),c.provide("highlight",c.computed(()=>{const a={...d.codeCss,...l==null?void 0:l.css},s=e.codeStyleReverse&&e.codeStyleReverseList.includes(e.previewTheme)?"dark":e.theme;return{js:(l==null?void 0:l.js)||d.highlightUrl,css:a[e.codeTheme]?a[e.codeTheme][s]:d.codeCss.atom[s]}})),c.provide("showCodeRowNumber",e.showCodeRowNumber);const t=c.computed(()=>{var s,m;const a={...d.staticTextDefault,...(m=(s=d.configOption)==null?void 0:s.editorConfig)==null?void 0:m.languageUserDefined};return a[e.language]?a[e.language]:d.staticTextDefault["zh-CN"]});c.provide("usedLanguageText",t),c.provide("previewTheme",c.computed(()=>e.previewTheme)),c.provide("customIcon",c.computed(()=>e.customIcon))},be=e=>{R(e),c.provide("tabWidth",e.tabWidth)},L=e=>{c.onMounted(()=>{var i,l;if(!e.noIconfont)if(d.configOption.iconfontType==="svg"){const t=document.createElement("script");t.src=((i=d.configOption.editorExtensions)==null?void 0:i.iconfont)||d.iconfontSvgUrl,t.id=`${d.prefix}-icon`,E.appendHandler(t)}else{const t=document.createElement("link");t.rel="stylesheet",t.href=((l=d.configOption.editorExtensions)==null?void 0:l.iconfontClass)||d.iconfontClassUrl,t.id=`${d.prefix}-icon-class`,E.appendHandler(t)}})},we=e=>{var s,m,u,o,f,w;const{noPrettier:i,noUploadImg:l}=e,{editorExtensions:t}=d.configOption,n=i||!!((m=(s=d.configOption.editorExtensions)==null?void 0:s.prettier)!=null&&m.prettierInstance),r=i||!!((o=(u=d.configOption.editorExtensions)==null?void 0:u.prettier)!=null&&o.parserMarkdownInstance),a=l||!!((w=(f=d.configOption.editorExtensions)==null?void 0:f.cropper)!=null&&w.instance);c.onMounted(()=>{var k,b,C,I;const y=document.createElement("script"),h=document.createElement("script");y.src=((k=t==null?void 0:t.prettier)==null?void 0:k.standaloneJs)||d.prettierUrl.main,y.id=`${d.prefix}-prettier`,h.src=((b=t==null?void 0:t.prettier)==null?void 0:b.parserMarkdownJs)||d.prettierUrl.markdown,h.id=`${d.prefix}-prettierMD`;const v=document.createElement("link");v.rel="stylesheet",v.href=((C=t==null?void 0:t.cropper)==null?void 0:C.css)||d.cropperUrl.css,v.id=`${d.prefix}-cropperCss`;const g=document.createElement("script");g.src=((I=t==null?void 0:t.cropper)==null?void 0:I.js)||d.cropperUrl.js,g.id=`${d.prefix}-cropper`,a||(E.appendHandler(v),E.appendHandler(g)),n||E.appendHandler(y),r||E.appendHandler(h)}),L(e)},ke=(e,i)=>{const{editorId:l}=e;c.onMounted(()=>{p.bus.on(l,{name:p.ERROR_CATCHER,callback:t=>{e.onError instanceof Function?e.onError(t):i.emit("onError",t)}})})},Ce=(e,i)=>{const{editorId:l}=e,t=c.reactive({pageFullscreen:e.pageFullscreen,fullscreen:!1,preview:e.preview,htmlPreview:e.preview?!1:e.htmlPreview}),n=(s,m)=>{t[s]=m===void 0?!t[s]:m,s==="preview"&&t.preview?t.htmlPreview=!1:s==="htmlPreview"&&t.htmlPreview&&(t.preview=!1)};let r="";const a=()=>{t.pageFullscreen||t.fullscreen?document.body.style.overflow="hidden":document.body.style.overflow=r};return c.watch(()=>[t.pageFullscreen,t.fullscreen],a),c.onMounted(()=>{p.bus.on(l,{name:p.UPLOAD_IMAGE,callback(s,m){const u=o=>{p.bus.emit(l,p.REPLACE,"image",{desc:"",urls:o}),m&&m()};e.onUploadImg?e.onUploadImg(s,u):i.emit("onUploadImg",s,u)}}),r=document.body.style.overflow,a()}),[t,n]},Ie=e=>{const{editorId:i}=e,l=c.ref(!1);return c.onMounted(()=>{p.bus.on(i,{name:p.CHANGE_CATALOG_VISIBLE,callback:n=>{n===void 0?l.value=!l.value:l.value=n}})}),c.computed(()=>!e.toolbarsExclude.includes("catalog")&&e.toolbars.includes("catalog")&&l.value)},$e=(e,i,l,t,n)=>{const{editorId:r}=e;c.watch(()=>t.pageFullscreen,s=>{p.bus.emit(r,p.PAGE_FULL_SCREEN_CHANGED,s)}),c.watch(()=>t.fullscreen,s=>{p.bus.emit(r,p.FULL_SCREEN_CHANGED,s)}),c.watch(()=>t.preview,s=>{p.bus.emit(r,p.PREVIEW_CHANGED,s)}),c.watch(()=>t.htmlPreview,s=>{p.bus.emit(r,p.HTML_PREVIEW_CHANGED,s)}),c.watch(l,s=>{p.bus.emit(r,p.CATALOG_VISIBLE_CHANGED,s)});const a={on(s,m){switch(s){case"pageFullscreen":{p.bus.on(r,{name:p.PAGE_FULL_SCREEN_CHANGED,callback(u){m(u)}});break}case"fullscreen":{p.bus.on(r,{name:p.FULL_SCREEN_CHANGED,callback(u){m(u)}});break}case"preview":{p.bus.on(r,{name:p.PREVIEW_CHANGED,callback(u){m(u)}});break}case"htmlPreview":{p.bus.on(r,{name:p.HTML_PREVIEW_CHANGED,callback(u){m(u)}});break}case"catalog":{p.bus.on(r,{name:p.CATALOG_VISIBLE_CHANGED,callback(u){m(u)}});break}}},togglePageFullscreen(s){n("pageFullscreen",s)},toggleFullscreen(s){p.bus.emit(r,p.CHANGE_FULL_SCREEN,s)},togglePreview(s){n("preview",s)},toggleHtmlPreview(s){n("htmlPreview",s)},toggleCatalog(s){p.bus.emit(r,p.CHANGE_CATALOG_VISIBLE,s)},triggerSave(){p.bus.emit(r,p.ON_SAVE)},insert(s){p.bus.emit(r,p.REPLACE,"universal",{generate:s})},focus(s){p.bus.emit(r,p.TEXTAREA_FOCUS,s)}};i.expose(a)},Ee=e=>e,N={modelValue:{type:String,default:""},theme:{type:String,default:"light"},class:{type:String,default:""},language:{type:String,default:"zh-CN"},onHtmlChanged:{type:Function},onGetCatalog:{type:Function},editorId:{type:String,default:d.defaultEditorId},showCodeRowNumber:{type:Boolean,default:!1},previewTheme:{type:String,default:"default"},style:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:Ee},sanitize:{type:Function,default:e=>e},noMermaid:{type:Boolean,default:!1},noKatex:{type:Boolean,default:!1},codeTheme:{type:String,default:"atom"},noIconfont:{type:Boolean},formatCopiedText:{type:Function,default:e=>e},codeStyleReverse:{type:Boolean,default:!0},codeStyleReverseList:{type:Array,default:["default","mk-cute"]},noHighlight:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean,default:!1},customIcon:{type:Object,default:{}}},xe={...N,onChange:{type:Function},onSave:{type:Function},onUploadImg:{type:Function},pageFullscreen:{type:Boolean,default:!1},preview:{type:Boolean,default:!0},htmlPreview:{type:Boolean,default:!1},toolbars:{type:Array,default:d.allToolbar},toolbarsExclude:{type:Array,default:[]},noPrettier:{type:Boolean,default:!1},tabWidth:{type:Number,default:2},tableShape:{type:Array,default:()=>[6,4]},placeholder:{type:String,default:""},defToolbars:{type:[String,Object]},onError:{type:Function},footers:{type:Array,default:d.allFooter},scrollAuto:{type:Boolean,default:!0},defFooters:{type:[String,Object]},noUploadImg:{type:Boolean},autoFocus:{type:Boolean},disabled:{type:Boolean},readOnly:{type:Boolean},maxLength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function},onFocus:{type:Function},completions:{type:Array},showToolbarName:{type:Boolean,default:!1},onInput:{type:Function},onDrop:{type:Function},inputBoxWitdh:{type:String,default:"50%"},onInputBoxWitdhChange:{type:Function}},B=["onHtmlChanged","onGetCatalog"],Se=[...B,"onChange","onSave","onUploadImg","onError","update:modelValue","onBlur","onFocus","onInput","onDrop","onInputBoxWitdhChange"],_e=c.defineComponent({name:"MdPreview",props:N,emits:B,setup(e,i){const{editorId:l,noKatex:t,noMermaid:n,noHighlight:r}=e;return R(e),L(e),c.onBeforeUnmount(()=>{p.bus.clear(l)}),()=>c.createVNode("div",{id:l,class:[d.prefix,e.class,e.theme==="dark"&&`${d.prefix}-dark`,`${d.prefix}-previewOnly`],style:e.style},[c.createVNode(F,{modelValue:e.modelValue,onHtmlChanged:a=>{e.onHtmlChanged?e.onHtmlChanged(a):i.emit("onHtmlChanged",a)},onGetCatalog:a=>{e.onGetCatalog?e.onGetCatalog(a):i.emit("onGetCatalog",a)},mdHeadingId:e.mdHeadingId,noMermaid:n,sanitize:e.sanitize,noKatex:t,formatCopiedText:e.formatCopiedText,noHighlight:r,noImgZoomIn:e.noImgZoomIn,previewOnly:!0},null)])}}),_=_e;_.install=e=>(e.component(_.name,_),e);exports.ContentPreview=F;exports.MdPreview=_;exports.contentProps=ve;exports.editorEmits=Se;exports.editorProps=xe;exports.useCatalog=Ie;exports.useConfig=Ce;exports.useErrorCatcher=ke;exports.useExpansion=we;exports.useExpose=$e;exports.useOnSave=ye;exports.useProvide=be;
